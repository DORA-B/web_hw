<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no" name="viewport">
    <title> Register &ndash; Tongji Oj </title>
    <link rel="stylesheet" href="login.css">
    <!-- <script type="text/javascript">
        window.$crisp = [];
        window.CRISP_WEBSITE_ID = "a1fa9264-647e-4682-a37f-f2f73d238bc8";
        CRISP_TOKEN_ID = '';
        (function() {
            d = document;
            s = d.createElement("script");
            s.src = "l.js";
            s.async = 1;
            d.getElementsByTagName("head")[0].appendChild(s);
        })();
    </script> -->

</head>

<body>

    <section class="section2">

        <div class="row">
            <div class="offset">
                <div class="logo_brand2">
                    <img src="assets/logo.svg" alt="logo" width="100" class="logo">
                </div>
                <div class="card">
                    <div class="card-header">
                        <h4>Ê≥®ÂÜå</h4>
                    </div>
                    <div class="card-body">
                        <form action="javascript:void(0);" class="nee_validate_zhuce" method="POST" novalidate>
                            <div class="row">
                                <div class="form-group col-lg-6 col-sm-12 col-xs-12">
                                    <label for="name">ÊòµÁß∞</label>
                                    <input id="name" type="text" class="form-control" name="name" required autofocus>
                                    <div class="invalid-feedback">
                                        ËØ∑Â°´ÂÜôÊòµÁß∞
                                    </div>
                                </div>
                                <div class="form-group col-lg-6 col-sm-12 col-xs-12">
                                    <label for="email">ÈÇÆÁÆ±</label>
                                    <div class="input-group">
                                        <input type="text" id="email" class="form-control col-7" required>
                                        <div class="invalid-feedback">
                                            ËØ∑Â°´ÂÜôÈÇÆÁÆ±
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="form-group col-lg-6 col-sm-12 col-xs-12">
                                    <label for="passwd" class="d-block">ÂØÜÁ†Å</label>
                                    <input id="passwd" type="password" class="form-control pwstrength" data-indicator="pwindicator" name="passwd" required>
                                    <div id="pwindicator" class="pwindicator">
                                        <div class="bar"></div>
                                        <div class="label"></div>
                                    </div>
                                    <div class="invalid-feedback">
                                        ËØ∑Â°´ÂÜôÂØÜÁ†Å
                                    </div>
                                </div>
                                <div class="form-group col-lg-6 col-sm-12 col-xs-12">
                                    <label for="repasswd" class="d-block">ÈáçÂ§çÂØÜÁ†Å</label>
                                    <input id="repasswd" type="password" class="form-control" name="repasswd" required>
                                    <div class="invalid-feedback">
                                        ËØ∑ÂÜçÊ¨°Â°´ÂÜôÂØÜÁ†Å
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <button id="register-confirm" onclick="doSignUp()" class="btn btn-primary btn-lg btn-block">
                            Ê≥®ÂÜå
                          </button>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="mt-5 text-muted text-center">
                    Â∑≤ÊúâË¥¶Âè∑‰∫ÜÔºü <a href="./login.html">ÁÇπÂáªÁôªÂΩï</a>
                </div>
                <div class="simple-footer">
                    Copyright &copy; 2021 KQC
                </div>
            </div>
        </div>

    </section>

    <!-- Ê≠§Â§Ñ‰Ωú‰∏∫scriptÂá∫Áé∞ÔºåÈúÄË¶ÅÂêéÊúüÁª¥Êä§‰∏é‰øÆÁêÜ -->
    <!--         
    <script>
        $(".pwstrength").pwstrength({
            texts: ['Ë∂ÖÁ∫ßÂº±È∏°', 'Âº±È∏°', '‰∏ÄËà¨Ëà¨', 'ÊúâÁÇπÂº∫', 'ÂæàÂº∫üëå']
        });

        function login(email, passwd) {
            $.ajax({
                type: "POST",
                url: "/auth/login",
                dataType: "json",
                data: {
                    email: email,
                    passwd: passwd,
                    code: '',
                    remember_me: 1
                },
                success: function(data) {
                    window.location.assign('/user')
                }
            });
        }

        function register() {
            // vaildation
            if (!$("#name").val() ||
                !$("#email").val() ||
                !$("#passwd").val() ||
                !$("#repasswd").val()
            ) {
                $('#register-confirm').removeClass("disabled")
                $('#register-confirm').removeAttr("disabled")
                return false
            };
            // eof vaildation


            code = $("#code").val();
            code = 0;
            if ((getCookie('code')) != '') {
                code = getCookie('code');
            }

            var email = $("#email").val() + $("#email_postfix").val();

            $.ajax({
                type: "POST",
                url: "/auth/register",
                dataType: "json",
                data: {
                    email: email,
                    name: $("#name").val(),
                    passwd: $("#passwd").val(),
                    repasswd: $("#repasswd").val(),
                    code: code
                },
                success: function(data) {
                    if (data.ret == 1) {
                        swal({
                            type: 'success',
                            title: 'Ê≥®ÂÜåÊàêÂäü',
                            showCloseButton: true,
                            onClose: () => {
                                login($("#email").val(), $("#passwd").val());
                            }
                        })
                    } else {
                        $('#register-confirm').removeClass("disabled")
                        $('#register-confirm').removeAttr("disabled")
                        $("#code").val(code);
                        swal({
                            type: 'error',
                            title: 'ÊèêÁ§∫',
                            showCloseButton: true,
                            text: data.msg
                        })
                    }
                }
            });
        }

        $("html").keydown(function(event) {
            if (event.keyCode == 13) {
                register()
            }
        });

        function doSignUp() {
            $('#register-confirm').addClass("disabled")
            $('#register-confirm').attr("disabled", "disabled")
            register()
        }
    </script> -->-->





    <script>
        function getQueryVariable(variable) {
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            for (var i = 0; i < vars.length; i++) {
                var pair = vars[i].split("=");
                if (pair[0] == variable) {
                    return pair[1];
                }
            }
            return "";
        }

        function setCookie(cname, cvalue, exdays) {
            var d = new Date();
            d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
            var expires = "expires=" + d.toGMTString();
            document.cookie = cname + "=" + cvalue + "; " + expires;
        }

        function getCookie(cname) {
            var name = cname + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i].trim();
                if (c.indexOf(name) == 0) return c.substring(name.length, c.length);
            }
            return "";
        }

        if (getQueryVariable('code') != '') {
            setCookie('code', getQueryVariable('code'), 30);
            window.location.href = '/auth/register';
        }
    </script>

</body>

</html>